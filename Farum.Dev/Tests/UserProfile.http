### Variables
@baseUrl = http://localhost:5052
@adminToken = YOUR_ADMIN_TOKEN
@userToken = YOUR_USER_TOKEN
@user2Token = YOUR_USER2_TOKEN

### Login as Admin
POST {{baseUrl}}/api/users/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}

### Login as User
POST {{baseUrl}}/api/users/login
Content-Type: application/json

{
  "username": "User",
  "password": "qazwsxedcrfv12345"
}

### Login as User2
POST {{baseUrl}}/api/users/login
Content-Type: application/json

{
  "username": "User2",
  "password": "password2"
}

###########################################
# USER PROFILE MANAGEMENT (Self)
###########################################

### Get Own Profile
GET {{baseUrl}}/api/users/profile
Authorization: Bearer {{userToken}}

### Update Own Profile
PUT {{baseUrl}}/api/users/profile
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "email": "john.doe.updated@example.com",
  "firstName": "Jonathan",
  "lastName": "Doe",
  "phoneNumber": "+1-555-9999"
}

### Update Profile - Clear Phone Number
PUT {{baseUrl}}/api/users/profile
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "email": "john.doe@example.com",
  "phoneNumber": null
}

###########################################
# ADDRESS MANAGEMENT (Self)
###########################################

### Add New Address
POST {{baseUrl}}/api/users/profile/addresses
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "addressType": 0,
  "street": "999 Test Street",
  "city": "San Francisco",
  "state": "CA",
  "postalCode": "94102",
  "country": "USA",
  "isDefault": false
}

### Update Existing Address
PUT {{baseUrl}}/api/users/profile/addresses/2
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "addressType": 0,
  "street": "456 Oak Avenue UPDATED",
  "city": "Los Angeles",
  "state": "CA",
  "postalCode": "90001",
  "country": "USA",
  "isDefault": true
}

### Set Default Address
PUT {{baseUrl}}/api/users/profile/addresses/3/set-default
Authorization: Bearer {{userToken}}

### Delete Address
DELETE {{baseUrl}}/api/users/profile/addresses/3
Authorization: Bearer {{userToken}}

### Try to Access Another User's Address (Should Fail)
PUT {{baseUrl}}/api/users/profile/addresses/1
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "addressType": 0,
  "street": "Hacked Street",
  "city": "Hacker City",
  "state": "HC",
  "postalCode": "00000",
  "country": "USA",
  "isDefault": true
}

###########################################
# PASSWORD CHANGE (Self)
###########################################

### Change Password - Success
PUT {{baseUrl}}/api/users/profile/change-password
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "oldPassword": "qazwsxedcrfv12345",
  "newPassword": "newpassword123"
}

### Change Password - Wrong Old Password (Should Fail)
PUT {{baseUrl}}/api/users/profile/change-password
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "oldPassword": "wrongpassword",
  "newPassword": "newpassword123"
}

### Change Password - Too Short (Should Fail)
PUT {{baseUrl}}/api/users/profile/change-password
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "oldPassword": "qazwsxedcrfv12345",
  "newPassword": "123"
}

### Change Password Back to Original
PUT {{baseUrl}}/api/users/profile/change-password
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "oldPassword": "newpassword123",
  "newPassword": "qazwsxedcrfv12345"
}

###########################################
# ADMIN USER MANAGEMENT
###########################################

### Admin - Get All Users
GET {{baseUrl}}/api/users/admin/users
Authorization: Bearer {{adminToken}}

### Admin - Get Specific User Details
GET {{baseUrl}}/api/users/admin/users/2
Authorization: Bearer {{adminToken}}

### Admin - Update User Profile
PUT {{baseUrl}}/api/users/admin/users/3
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "jane.smith.admin@example.com",
  "firstName": "Janet",
  "lastName": "Smith-Updated",
  "phoneNumber": "+1-555-8888",
  "role": "User"
}

### Admin - Reset User Password
POST {{baseUrl}}/api/users/admin/users/3/reset-password
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newPassword": "resetpassword123"
}

### Admin - Reset Password Too Short (Should Fail)
POST {{baseUrl}}/api/users/admin/users/3/reset-password
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newPassword": "123"
}

### Admin - Reset Password Back
POST {{baseUrl}}/api/users/admin/users/3/reset-password
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newPassword": "password2"
}

###########################################
# AUTHORIZATION TESTS
###########################################

### Regular User Tries Admin Endpoint - Get All Users (Should Fail)
GET {{baseUrl}}/api/users/admin/users
Authorization: Bearer {{userToken}}

### Regular User Tries Admin Endpoint - Update Another User (Should Fail)
PUT {{baseUrl}}/api/users/admin/users/3
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "email": "hacked@example.com"
}

### Regular User Tries Admin Endpoint - Reset Password (Should Fail)
POST {{baseUrl}}/api/users/admin/users/1/reset-password
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
  "newPassword": "hackedpassword"
}

### No Token - Get Profile (Should Fail)
GET {{baseUrl}}/api/users/profile

### No Token - Admin Endpoint (Should Fail)
GET {{baseUrl}}/api/users/admin/users

###########################################
# ADDRESS TYPE TESTS
###########################################

### Add Shipping Address
POST {{baseUrl}}/api/users/profile/addresses
Authorization: Bearer {{user2Token}}
Content-Type: application/json

{
  "addressType": 0,
  "street": "111 Shipping Lane",
  "city": "Seattle",
  "state": "WA",
  "postalCode": "98101",
  "country": "USA",
  "isDefault": false
}

### Add Billing Address
POST {{baseUrl}}/api/users/profile/addresses
Authorization: Bearer {{user2Token}}
Content-Type: application/json

{
  "addressType": 1,
  "street": "222 Billing Boulevard",
  "city": "Seattle",
  "state": "WA",
  "postalCode": "98102",
  "country": "USA",
  "isDefault": false
}

### Add Both (Shipping + Billing) Address
POST {{baseUrl}}/api/users/profile/addresses
Authorization: Bearer {{user2Token}}
Content-Type: application/json

{
  "addressType": 2,
  "street": "333 Universal Drive",
  "city": "Seattle",
  "state": "WA",
  "postalCode": "98103",
  "country": "USA",
  "isDefault": true
}

### User2 - Get Profile to See All Addresses
GET {{baseUrl}}/api/users/profile
Authorization: Bearer {{user2Token}}
